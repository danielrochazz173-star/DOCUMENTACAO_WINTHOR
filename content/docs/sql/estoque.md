---
title: Estoque (PCEST)
---

Consulta padrão para estoque em caixas e informações de produto.

## Estoque por CODFAB (com departamento e EAN)

```sql
SELECT
    P.CODPROD,
    P.DESCRICAO,
    P.CODFAB,
    P.CODAUXILIAR AS EAN,
    P.EMBALAGEM,
    P.PESOLIQ,
    P.QTUNITCX,
    D.DESCRICAO AS DEPARTAMENTO,
    D.CODEPTO,
    COALESCE(
        (E.QTESTGER - E.QTRESERV - E.QTBLOQUEADA) / NULLIF(P.QTUNITCX, 1),
        (E.QTESTGER - E.QTRESERV - E.QTBLOQUEADA),
        0
    ) AS ESTOQUE_CX
FROM PCPRODUT P
LEFT JOIN PCDEPTO D ON P.CODEPTO = D.CODEPTO
LEFT JOIN PCEST E ON P.CODPROD = E.CODPROD AND E.CODFILIAL = '1'
WHERE P.CODFAB = :codfab
  AND P.DTEXCLUSAO IS NULL
  AND (P.OBS2 <> 'FL' OR P.OBS2 IS NULL)
  AND P.REVENDA = 'S'
ORDER BY P.DESCRICAO
```

## Estoque por categoria (100/101)

```sql
SELECT
    P.CODPROD,
    P.DESCRICAO AS NOMEPRODUT,
    CASE
        WHEN P.CODCATEGORIA = 100 THEN 'CONGELADO'
        WHEN P.CODCATEGORIA = 101 THEN 'RESFRIADO'
        WHEN P.CODCATEGORIA IS NULL THEN 'SEM CATEGORIA'
        ELSE NVL(CAT.CATEGORIA, 'OUTRO')
    END AS CATEGORIA,
    P.CODCATEGORIA,
    D.DESCRICAO AS DEPARTAMENTO,
    D.CODEPTO,
    P.QTUNITCX,
    COALESCE(
        (E.QTESTGER - E.QTRESERV - E.QTBLOQUEADA) / NULLIF(P.QTUNITCX, 1),
        (E.QTESTGER - E.QTRESERV - E.QTBLOQUEADA),
        0
    ) AS ESTOQUE_CX_ORACLE
FROM PCPRODUT P
LEFT JOIN PCCATEGORIA CAT ON P.CODCATEGORIA = CAT.CODCATEGORIA AND P.CODSEC = CAT.CODSEC
LEFT JOIN PCDEPTO D ON P.CODEPTO = D.CODEPTO
LEFT JOIN PCEST E ON P.CODPROD = E.CODPROD AND E.CODFILIAL = '1'
WHERE (P.CODCATEGORIA IN (:lista_categorias) OR P.CODCATEGORIA IS NULL)
  AND P.DTEXCLUSAO IS NULL
  AND (P.OBS2 <> 'FL' OR P.OBS2 IS NULL)
  AND P.REVENDA = 'S'
ORDER BY D.DESCRICAO, P.DESCRICAO
```

## Regra de estoque em caixas

```
ESTOQUE_CX = (QTESTGER - QTRESERV - QTBLOQUEADA) / QTUNITCX
```
